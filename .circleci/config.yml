version: 2.1

executors:
    # Define the environment where jobs will run
    php-executor:
        docker:
            - image: cimg/php:8.0 # Docker image with PHP and Composer installed
        working_directory: ~/repo # Working directory inside the container

jobs:
    # Job to install dependencies
    install_dependencies:
        executor: php-executor
        steps:
            - checkout # Checkout your code
            - run:
                  name: Install Composer dependencies
                  command: composer install --prefer-dist --no-interaction; composer update

    # Job to run tests
    run_tests:
        executor: php-executor
        steps:
            - checkout
            - run:
                  name: Run Tests
                  command: composer run tests

workflows:
    version: 2
    # Define the order of job execution
    build_and_deploy:
        jobs:
            - install_dependencies
            - run_tests:
                  requires:
                      - install_dependencies
